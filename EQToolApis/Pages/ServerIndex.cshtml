@page "/ServerIndex/{server}"
@using EQToolApis.DB;
@model EQToolApis.Pages.ServerIndexModel
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="https://unpkg.com/tabulator-tables@5.4.4/dist/css/tabulator.min.css" rel="stylesheet">
<script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.4.4/dist/js/tabulator.min.js"></script>
<script>
    $(document).ready(function () {
        let tableData = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.AuctionItems,  new Newtonsoft.Json.Converters.StringEnumConverter()));
        var valueEl = document.getElementById("filter-value");

        //Custom filter example
        function customFilter(data) {
            return data.car && data.rating < 3;
        }

        //Trigger setFilter function with correct parameters
        function updateFilter() {
            debugger;
            table.setFilter("ItemName", "like", valueEl.value);
        }

        document.getElementById("filter-value").addEventListener("keyup", updateFilter);

        //Clear filters on "Clear Filters" button click
        document.getElementById("filter-clear").addEventListener("click", function () {
            valueEl.value = "";

            table.clearFilter();
        });
        window.opem
        var table = new Tabulator("#example-table",
            {
                maxHeight: "90%",
                layout: "fitDataStretch",
                data: tableData, //set initial table data
                columns: [
                    { title: "Type", field: "AuctionType" },
                    {
                        title: "Last Seen", field: "LastSeen",
                        formatter: function (cell, formatterParams) {
                            let lastseen = cell.getRow().getData().LastSeen;
                            let d = new Date(lastseen);
                            return d.toLocaleString();
                        }
                    },
                    {
                        title: "Item", field: "ItemName",
                        formatter: function (cell, formatterParams) {
                            var row = cell.getRow().getData();
                            return `<a href="/ItemDetails/${row.ItemId}/@(Model.Server)" target="_blank">${row.ItemName} </a>  <a class="float-right" href="https://wiki.project1999.com/${row.ItemName.replace(' ', '_')}" target="_blank"><i class="fa fa-external-link"></i></a> `;
                        }
                    },
                    { title: "30d Count", field: "TotalLast30DaysCount" },
                    { title: "30d Avg", field: "TotalLast30DaysAverage" },
                    { title: "60d Count", field: "TotalLast60DaysCount" },
                    { title: "60d Avg", field: "TotalLast60DaysAverage" },
                    { title: "90d Count", field: "TotalLast90DaysCount" },
                    { title: "90d Avg", field: "TotalLast90DaysAverage" },
                    { title: "6M Count", field: "TotalLast6MonthsCount" },
                    { title: "6M Avg", field: "TotalLast6MonthsAverage" },
                    { title: "All Count", field: "TotalAuctionCount" },
                    { title: "All Avg", field: "TotalAuctionAverage" },
                ],
                progressiveRender: true, //enable progressive rendering
                progressiveRenderSize: 500, //sets the number of rows to render per block (default = 20)
                progressiveRenderMargin: 350,
            });
    });
</script>

<div class="w-100 vh-100">
    <h3>@Model.Server Data </h3>
    <input id="filter-value" type="text" placeholder="value to filter">
    <button id="filter-clear">Clear Filter</button>
    <div id="example-table"></div>
</div>
